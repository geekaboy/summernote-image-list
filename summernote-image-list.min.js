!function(i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof module&&module.exports?module.exports=i(require("jquery")):i(window.jQuery)}(function(f){f.extend(f.summernote.plugins,{imageList:function(t){var a=this,s=f.summernote.ui,e=t.layoutInfo.editor,n=t.options,i=!1;for(var o in n.toolbar){var l=n.toolbar[o][1];if(-1<f.inArray("imageList",l)){i=!0;break}}if(i){var r={title:"รายการรูปภาพ",tooltip:"รายการรูปภาพ",buttonHtml:'<i class="fa fa-file-image-o"></i>',spinnerHtml:'<span class="fa fa-spinner fa-spin" style="font-size: 50px; line-height: 100px; margin-left: calc(50% - 50px)"></span>',endpoint:"",fullUrlPrefix:"",thumbUrlPrefix:"",uploadPath:"",delPath:""},d=void 0===n.imageList?{}:n.imageList;for(var c in r)!1===d.hasOwnProperty(c)&&(d[c]=r[c]);t.memo("button.imageList",function(){return s.button({contents:d.buttonHtml,container:!1,tooltip:d.tooltip,click:function(i){a.show()}}).render()}),this.createDialog=function(i){var e={title:d.title,body:['<div class="custom-file col-sm-6 mb-3">','<input type="file" class="custom-file-input" id="imgfile" name="imgfile">','<label class="custom-file-label" for="customFile">Choose image</label>',"</div>",'<div class="image-list-content"></div>'].join(""),footer:['<button type="button" class="btn btn-primary image-list-btn-close">Close</button>'].join(""),closeOnEscape:!0};a.$dialog=s.dialog(e).render().appendTo(i),a.$dialog.find(".modal-dialog").addClass("modal-lg")},this.showDialog=function(){return f.Deferred(function(i){s.onDialogShown(a.$dialog,function(){t.triggerEvent("dialog.shown"),a.$dialog.modal({backdrop:"static"}),a.$dialog.find(".image-list-content").html(d.spinnerHtml),a.getImgaeList(),a.$dialog.find(".image-list-btn-close").click(function(i){s.hideDialog(a.$dialog),a.$dialog.remove()})}),s.onDialogHidden(a.$dialog,function(){a.destroy(),"pending"===i.state()&&i.reject()}),s.showDialog(a.$dialog),a.$dialog.find("input[name=imgfile]").change(function(i){a.$dialog.find(".image-list-content").html(d.spinnerHtml);var e=d.uploadPath,t=f(this)[0].files[0],n=new FormData;n.append("file",t);var o=new XMLHttpRequest;o.open("POST",e,!0),o.onload=function(){if(200<=o.status&&o.status<400)a.getImgaeList();else o.responseText},o.onerror=function(i,e,t){console.log(i)},o.send(n)})})},this.insertImage=function(i,e){e=e.replace("https:","").replace("http:",""),t.invoke("editor.insertNode",f('<img src="'+e+'" data-filename="'+i+'">')[0])},this.show=function(){e.hasClass("fullscreen")||f("html, body").css("overflow",""),t.invoke("editor.saveRange"),a.showDialog().then(function(i){t.invoke("editor.restoreRange"),a.insertImage(i.filename,i.fullUrl),s.hideDialog(a.$dialog)}).fail(function(){t.invoke("editor.restoreRange")})},this.getImgaeList=function(){f.get(d.endpoint,null,null,"json").done(function(i){var t=[],n=d.fullUrlPrefix,o=d.thumbUrlPrefix,l=0;f.each(i,function(i,e){l++,t.push(['<div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">','<button type="button" class="btn btn-sm btn-warning text-white float-right btn-img-del">','<span class="fa fa-trash-o"></span>',"</button>",'<div class="image-list-item">','<img class="img-insert" src="'+o+e.file_name+'"data-filetitle="'+e.file_title+'" data-filename="'+e.file_name+'" data-full-url="'+n+e.file_name+'">','<p class="text-truncate"  style="max-width: 160px;">'+e.file_title+"</p>","</div>","</div>"].join("")),0<l+1&&(l+1)%2==0&&t.push('<div class="clearfix visible-xs-block"></div>'),0<l+1&&(l+1)%3==0&&t.push('<div class="clearfix visible-sm-block"></div>'),0<l+1&&(l+1)%4==0&&t.push('<div class="clearfix visible-md-block visible-lg-block"></div>')}),a.$dialog.find(".image-list-content").html('<div class="row">'+t.join("")+"</div>"),a.$dialog.find(".img-insert").click(function(i){var e=f(this).data("filename"),t=f(this).data("full-url");a.insertImage(e,t),s.hideDialog(a.$dialog)}),f(".btn-img-del").click(function(i){var e=f(this).next(".image-list-item").children(".img-insert");if(confirm("Are you sure you want to delete "+e.data("filetitle")+"?")){var t={filename:e.data("filename")},n=d.delPath;f.post(n,t,function(i,e,t){i.is_success?a.getImgaeList():alert(i.msg)},"json").fail(function(){alert("Something wrong, Please try again.")})}})})},this.initialize=function(){var i=n.dialogsInBody?f("body"):e;a.createDialog(i)},this.destroy=function(){s.hideDialog(a.$dialog),a.$dialog.remove()}}}})});
